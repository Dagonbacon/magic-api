<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<!--<link rel="shortcut icon" href="/favicon.ico" />-->
<link rel="stylesheet" href="scry.css">
<title>Scry - Magic: The Gathering card search</title>
</head>
<body>
	<img id="cardImage">
	
	<article>
		<h1>Scry</h1>
		<h2 id="status"></h2>
		
		<p id="warning"><em>Can't fetch image for that card</em></p>

		<form action="api.php" method="POST">
			<input id="name" placeholder="Battlewise Hoplite">
			<input type="submit" value="Get card" >
		</form>
		
		<dl id="results"></dl>

		<p><a href="http://stegriff.co.uk">SteGriff</a></p>
	</article>
	
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
<script type="text/javascript">
$(function(){
	$('#name').focus();
	showWarning(false);
	$('form').submit(function(e){
		e.preventDefault();
		getCard();
	});
});
function getCard(){
	var cardName = $('#name').val();
	getting(true, cardName);
	
	//Request card data from magic-api
	$.get('./api.php', { 'name' : cardName }, function(data){
		var $panel = $('#results');
		
		//Remove last card results
		$panel.children().remove();

		//Print out every returned attribute in a definition list
		for(d in data){
			//console.log(d, data[d]);
			$panel.append("<dt>" + d + "</dt><dd>" + data[d] + "</dd>");
		}
		
		getImage(data.name);
		getting(false);
	});
}

function getting(inProgress, cardName){
	$status = $('#status');	
	if (inProgress){
		$status.text("Getting " + cardName + "...");
		$status.show();
	}
	else{
		$status.hide();
	}
}

function getImage(cardName){
	var baseUrl = "http://mtgimage.com/card/";
	var url = baseUrl + cardName + ".jpg";
	$("#cardImage").attr("src",url);
	showCard(true);
}

function showCard(on){
	if (on){
		$("#cardImage").show();
		showWarning(false);
		$('article').addClass('shrink');
	}
	else{
		$("#cardImage").hide();
		showWarning(true);
		$('article').removeClass('shrink');
	}
}

function showWarning(on){
	if (on){
		$("#warning").show();
	}
	else{
		$("#warning").hide();
	}
}

</script>	
<script src="js/placeholder.js"></script>
</body>
</html>